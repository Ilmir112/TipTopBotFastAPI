from aiogram.types import KeyboardButton, Message, ReplyKeyboardMarkup

from app.api.users.dao import UsersDAO
from app.bot.keyboards.kbs import main_keyboard


def get_about_us_text() -> str:
    return """1
üîß –®–ò–ù–û–ú–û–ù–¢–ê–ñ "TIP-TOP" üîß

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –Ω–∞–¥–µ–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è!

‚ú® –ù–∞—à–∞ –º–∏—Å—Å–∏—è:
–û–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–º—Ñ–æ—Ä—Ç –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è, –ø—Ä–µ–¥–ª–∞–≥–∞—è 
–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ.

üöó –ù–∞—à–∏ —É—Å–ª—É–≥–∏:
‚Ä¢ –ó–∞–º–µ–Ω–∞ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —à–∏–Ω
‚Ä¢ –†–µ–º–æ–Ω—Ç –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∏–Ω
‚Ä¢ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–≤–ª–µ–Ω–∏—è
‚Ä¢ –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∑–æ–Ω–Ω—ã—Ö —à–∏–Ω
‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Å–Ω—è—Ç–∏–µ –∫–æ–ª—ë—Å

üë∑‚Äç‚ôÇÔ∏è –ù–∞—à–∏ –º–∞—Å—Ç–µ—Ä–∞:
–û–ø—ã—Ç–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã —Å –≤—ã—Å–æ–∫–æ–π –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
 –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.

üåø –ù–∞—à–∞ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞:
–ö–æ–º—Ñ–æ—Ä—Ç –∏ –¥–æ–≤–µ—Ä–∏–µ ‚Äî –Ω–∞—à–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã. –ú—ã —Ü–µ–Ω–∏–º –≤–∞—à–µ –≤—Ä–µ–º—è –∏ —Å—Ç–∞—Ä–∞–µ–º—Å—è 
—Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä—ã–º –∏ —É–¥–æ–±–Ω—ã–º.

üíé –ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å:
‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚Ä¢ –ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
‚Ä¢ –£—é—Ç–Ω–∞—è –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–∞—Å—Ç–µ—Ä—Å–∫–∞—è
‚Ä¢ –£–¥–æ–±–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –≥–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã

–û–±–µ—Å–ø–µ—á—å—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –≤–º–µ—Å—Ç–µ —Å "TIP-TOP" üîß
"!
–ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ –¥–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º.

‚ú® –í–∞—à–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî –Ω–∞—à –≥–ª–∞–≤–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç! ‚ú®
"""


async def greet_user(
    message: Message, is_new_user: bool, has_phone: bool = True
) -> None:
    """
    –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
    """
    greeting = "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å" if is_new_user else "–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º"
    status = "–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã!" if is_new_user else "–†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞!"
    text = (
        f"{greeting}, <b>{message.from_user.full_name}</b>! {status}\n"
        f"<b>{message.from_user.full_name}</b>!"
        "–ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å–µ–≥–æ–¥–Ω—è?"
    )
    await message.answer(text)
    phone_mes = (
        "–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ—à—É –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
        if has_phone is False
        else text
    )
    if has_phone is False:
        await send_contact_request_keyboard(message)
        return

    await message.answer(
        phone_mes,
        reply_markup=main_keyboard(
            user_id=message.from_user.id,
            first_name=message.from_user.first_name,
            has_phone=has_phone,
        ),
    )


async def user_has_phone(user_id: int) -> bool:
    user = await UsersDAO.find_one_or_none_by_id(data_id=user_id)
    if user:
        if str(user.telephone_number).isdigit():
            return True
    return False


async def send_contact_request_keyboard(message: Message):
    keyboard = ReplyKeyboardMarkup(
        resize_keyboard=True,
        one_time_keyboard=True,
        keyboard=[[KeyboardButton(text="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º", request_contact=True)]],
    )
    await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –Ω–æ–º–µ—Ä–æ–º", reply_markup=keyboard)
